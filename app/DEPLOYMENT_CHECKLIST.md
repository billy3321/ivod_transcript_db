# IVOD 逐字稿應用程式部署檢查清單

## 部署前準備

### 系統需求檢查
- [ ] Ubuntu 20.04+ 伺服器
- [ ] 至少 2GB RAM
- [ ] 至少 20GB 磁碟空間
- [ ] sudo 權限
- [ ] 網域名稱指向伺服器

### 軟體安裝
- [ ] Node.js 18+ 已安裝
- [ ] npm 已安裝
- [ ] nginx 已安裝
- [ ] PM2 已安裝（如使用 PM2 方案）
- [ ] 資料庫已安裝（PostgreSQL/MySQL）
- [ ] Elasticsearch 已安裝（可選）

## 應用程式部署

### 程式碼部署
- [ ] 程式碼已克隆到伺服器
- [ ] `.env.local` 檔案已建立並設定
- [ ] 依賴套件已安裝 (`npm ci --only=production`)
- [ ] Prisma 客戶端已產生 (`npm run prisma:generate`)
- [ ] 應用程式已建置 (`npm run build`)

### 資料庫設定
- [ ] 資料庫已建立
- [ ] 資料庫使用者已建立
- [ ] 資料庫權限已設定
- [ ] 資料庫連線測試通過

### 進程管理設定
#### PM2 方案
- [ ] `ecosystem.config.js` 已建立
- [ ] PM2 應用程式已啟動
- [ ] PM2 開機自啟已設定
- [ ] PM2 監控已啟用

#### systemd 多實例方案
- [ ] systemd 服務檔案已建立
- [ ] 多實例已啟動
- [ ] 服務開機自啟已啟用

#### Docker 方案
- [ ] Dockerfile 已建立
- [ ] docker-compose.prod.yml 已建立
- [ ] Docker Swarm 已初始化
- [ ] 服務已部署

### 反向代理設定
- [ ] nginx 站點配置已建立
- [ ] nginx 配置測試通過
- [ ] nginx 服務已重新載入
- [ ] 防火牆規則已設定

### SSL 證書設定
- [ ] Certbot 已安裝
- [ ] SSL 證書已申請
- [ ] 自動更新已設定
- [ ] HTTPS 重新導向已啟用

## 監控和日誌

### 健康檢查
- [ ] `/api/health` 端點回應正常
- [ ] 應用程式健康狀態正常
- [ ] 資料庫連線狀態正常
- [ ] Elasticsearch 連線狀態正常（如適用）

### 監控設定
- [ ] PM2 監控已啟用（如適用）
- [ ] 系統監控工具已安裝（netdata/其他）
- [ ] 監控儀表板可存取
- [ ] 告警機制已設定

### 日誌管理
- [ ] 應用程式日誌輪轉已設定
- [ ] nginx 日誌輪轉已設定
- [ ] 系統日誌監控已設定

## 安全性檢查

### 基本安全
- [ ] 系統已更新
- [ ] 自動安全更新已啟用
- [ ] fail2ban 已安裝並設定
- [ ] 防火牆已正確設定

### 應用程式安全
- [ ] 環境變數檔案權限正確 (600)
- [ ] 應用程式使用非 root 使用者執行
- [ ] 敏感路由已受保護
- [ ] 安全標頭已設定

### 資料庫安全
- [ ] 資料庫只允許本地連線
- [ ] 資料庫使用者權限最小化
- [ ] 資料庫密碼強度足夠

## 效能優化

### 應用程式效能
- [ ] 叢集模式已啟用
- [ ] 適當的實例數量
- [ ] 記憶體限制已設定
- [ ] CPU 使用率合理

### 網頁伺服器效能
- [ ] 靜態檔案快取已設定
- [ ] Gzip 壓縮已啟用
- [ ] 連線池已設定
- [ ] 適當的超時設定

### 資料庫效能
- [ ] 資料庫連線池已設定
- [ ] 必要的索引已建立
- [ ] 查詢效能已優化

## 測試和驗證

### 功能測試
- [ ] 主頁載入正常
- [ ] 搜尋功能正常
- [ ] IVOD 詳細頁面正常
- [ ] API 端點回應正常

### 效能測試
- [ ] 頁面載入速度合理（< 3 秒）
- [ ] 並發請求處理正常
- [ ] 記憶體使用率穩定
- [ ] CPU 使用率合理

### 安全測試
- [ ] SSL 證書有效
- [ ] 安全標頭存在
- [ ] 敏感資訊未暴露
- [ ] 輸入驗證正常

## 備份和災難恢復

### 備份設定
- [ ] 資料庫備份腳本已建立
- [ ] 定期備份已排程
- [ ] 備份儲存位置已設定
- [ ] 備份還原程序已測試

### 災難恢復
- [ ] 恢復程序已文件化
- [ ] 恢復時間目標（RTO）已定義
- [ ] 恢復點目標（RPO）已定義
- [ ] 緊急聯絡資訊已準備

## 上線後檢查

### 立即檢查（部署後 1 小時內）
- [ ] 所有服務正常運行
- [ ] 監控系統正常
- [ ] 沒有錯誤日誌
- [ ] 使用者可正常存取

### 短期檢查（部署後 24 小時內）
- [ ] 系統穩定性良好
- [ ] 效能指標正常
- [ ] 沒有記憶體洩漏
- [ ] 監控告警正常

### 長期檢查（部署後 1 週內）
- [ ] 系統負載穩定
- [ ] 資料庫效能良好
- [ ] 日誌輪轉正常
- [ ] 備份作業正常

## 緊急聯絡資訊

```
系統管理員：
技術支援：
雲端服務商：
網域註冊商：
SSL 證書商：
```

## 重要檔案位置

```
應用程式目錄：/home/ubuntu/ivod_transcript_db/app
環境變數檔案：/home/ubuntu/ivod_transcript_db/app/.env.local
nginx 配置：/etc/nginx/sites-available/ivod-app
PM2 配置：/home/ubuntu/ivod_transcript_db/app/ecosystem.config.js
應用程式日誌：/var/log/pm2/
nginx 日誌：/var/log/nginx/
系統日誌：/var/log/syslog
```

## 常用指令

```bash
# 檢查應用程式狀態
pm2 status

# 檢查日誌
pm2 logs ivod-app
sudo tail -f /var/log/nginx/error.log

# 重啟服務
pm2 restart ivod-app
sudo systemctl reload nginx

# 檢查健康狀態
curl http://localhost:3000/api/health

# 監控系統資源
htop
free -h
df -h
```

---

**注意：** 請在每次部署時使用此檢查清單，確保所有步驟都已完成。